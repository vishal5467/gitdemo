if (self.CavalryLogger) { CavalryLogger.start_js(["4oXfV"]); }

__d("NotificationCounter",["Arbiter","CrossWindowEventEmitter","CurrentUser","DocumentTitle","FavIcon","JSLogger","MercuryConfig","MessengerEnvironment"],(function a(b,c,d,e,f,g){__p&&__p();var h=new(c("CrossWindowEventEmitter"))("JewelBase"),i={messages:0,notifications:0,requests:0},j={init:function k(){c("Arbiter").subscribe("update_title",this._handleUpdate.bind(this));c("Arbiter").subscribe("jewel/count-updated",this._handleCountUpdate.bind(this));h.addListener("count-updated",function(l){this._handleCountUpdate("",l)}.bind(this));if(c("MercuryConfig").FaviconBadge&&!c("CurrentUser").isWorkUser())c("FavIcon").setToggleResources(c("MercuryConfig").FaviconBadgedURL)},getCount:function k(){__p&&__p();var l=0;for(var m in i){var n=Number(i[m]);if(typeof i[m]=="string"&&isNaN(n))return i[m];if(isNaN(n)||n<0){c("JSLogger").create("jewels").error("bad_count",{jewel:m,count:i[m]});continue}l+=n}return l},updateTitle:function k(){if(c("MessengerEnvironment").messengerui)return;var l=this.getCount(),m=c("DocumentTitle").get();m=l?"("+l+") "+m:m;c("DocumentTitle").set(m,true);if(c("MercuryConfig").FaviconBadge)c("FavIcon").toggleSet(parseInt(l,10)>0)},_handleCountUpdate:function k(l,m){i[m.jewel]=m.count;this.updateTitle()},_handleUpdate:function k(l,m){this.updateTitle()}};f.exports=j}),null);
__d("NotificationJewelController",["Arbiter","Bootloader","Event","EventProfiler","FunnelLogger","NotificationConstants","NotificationCounter","NotificationJewelFunnelLoggingConstants","NotificationSeenState","NotificationStore","NotificationUpdates","createObjectFrom","curry","isInFocusMode","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("NotificationConstants").PayloadSourceType,i=c("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME,j=c("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_EVENT,k=0,l=false;function m(o){var p=c("isInFocusMode")(),q=c("NotificationSeenState").getUnseenCount();c("Arbiter").inform("jewel/count-updated",{jewel:o,count:p?0:q,animation:!p&&l&&q>0?"heart":"none"},c("Arbiter").BEHAVIOR_STATE)}function n(o,p){"use strict";__p&&__p();var q=p.badgeAnimationData,r=p.endPoint,s=p.list,t=p.startTime,u=p.unseenNotifs;if(r)c("NotificationStore").registerEndpoint({endpointURI:r});c("NotificationCounter").init();var v=false,w=null,x=c("Event").listen(o.getRoot(),"mouseover",function(){if(!v){v=true;w=c("EventProfiler").notifyRunningEagerInteraction(o.getRoot(),["Notifications_Jewel_Button"],"click")}c("FunnelLogger").startFunnel(i);x&&x.remove();x=null;s.open();c("FunnelLogger").appendAction(i,j.MOUSE_OVER_ON_JEWEL)}),y=null;c("Event").listen(o.getRoot(),"mouseover",function(){y=c("setTimeoutAcrossTransitions")(function(){c("Bootloader").loadModules(["QE2Logger"],function(C){C.logExposureForUser("www_jewel_tooltip_experiment")},"NotificationJewelController");y=null},500)});c("Event").listen(o.getRoot(),"mouseout",function(){if(y)clearTimeout(y)});var z=false,A=o.subscribe("opened",function(){if(!z){z=true;c("EventProfiler").tagCurrentActiveInteractionsAs("FirstNotificationJewelOpen")}if(w)w();A&&A.unsubscribe();A=null;s.open()}),B=s.pause.bind(s);o.subscribe("opened",function(){setTimeout(B,0);m(o.name);c("Bootloader").loadModules(["NotificationVPVs"],function(C){return C.clearImpressions()},"NotificationJewelController");c("Arbiter").inform("notificationJewel/opened")});o.subscribe("closed",function(){s.unpause();m(o.name);c("Arbiter").inform("notificationJewel/closed")});c("NotificationUpdates").subscribe("seen-state-updated",c("curry")(m,o.name));if(q){if(q.logWithQEUniverse)c("Bootloader").loadModules(["QE2Logger"],function(C){return C.logExposureForUser(q.logWithQEUniverse)},"NotificationJewelController");if(q.injectWithAnimation)c("Bootloader").loadModules(["RelationshipDelightsBadge"],function(C){return C.inject(o,q.injectWithAnimation)},"NotificationJewelController");c("Bootloader").loadModules(["RelationshipDelightUtils"],function(C){__p&&__p();c("NotificationUpdates").subscribe("update-notifications",function(D,E){var F=E.nodes,G=E.payloadsource,H=F&&F.length?F.filter(C.shouldHeartBadge):null;if(H&&H.length){l=true;if(q.injectWithAnimation)if(G===h.INITIAL_LOAD||G===h.INITIAL_SEND)C.logBadgeAnimation(H[0].alert_id)}else l=false});if(q.logWithAlertID)C.logBadgeAnimation(q.logWithAlertID)},"NotificationJewelController")}c("NotificationUpdates").handleUpdate(h.INITIAL_LOAD,{seenState:c("createObjectFrom")(u,k)});m(o.name);c("NotificationUpdates").setEndPoint(r)}f.exports=n}),null);