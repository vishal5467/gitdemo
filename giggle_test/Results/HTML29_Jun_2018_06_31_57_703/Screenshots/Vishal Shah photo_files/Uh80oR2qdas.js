if (self.CavalryLogger) { CavalryLogger.start_js(["xEqSW"]); }

__d("MessengerThreadsWebGraphQLQuery",["WebGraphQLQueryBase"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();f.exports=function(){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("WebGraphQLQueryBase"));i=h&&h.prototype;j.__getDocID=function(){"use strict";return"1652793134787105"};j.getQueryID=function(){"use strict";return"1307355802707669"};function j(){"use strict";h.apply(this,arguments)}return j}()}),null);
__d("messengerReadReceiptTransformerRe",["bs_array","bs_caml_format"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j){var k={};c("bs_array").iter(function(l){var m=l.actor;if(!(m==null)&&i!==m.id){k[m.id]={action:c("bs_caml_format").caml_float_of_string(l.action),watermark:c("bs_caml_format").caml_float_of_string(l.watermark)};return 0}else return 0},j.nodes);return k}g.transformReadReceipt=h}),null);
__d("messengerThreadTransformerRe",["URI","bs_array","bs_string","bs_caml_array","bs_js_boolean","MercuryIDs","bs_caml_format","bs_js_primitive","WorkModeConfig","bs_js_null_undefined","MessagingThreadType","messengerAttachmentTransformerRe","MessengerThreadCannotReplyReason"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(p){__p&&__p();var q=p.location_coordinates,r=q==null?[null,null]:[q.latitude,q.longitude],s=p.location_page,t;if(s==null)t=null;else{var u=s.address;t=u==null?null:u.full_address}var v=p.allows_rsvp,w=v!==0?1:0,x=c("bs_array").fold_left(function(z,A){z[A.node.id]=A.guest_list_state;return z},{},p.event_reminder_members.edges),y=p.lightweight_event_creator;return{creator_id:y==null?null:y.id,event_members:x,event_time:p.time,event_type:p.lightweight_event_type,latitude:r[0],longitude:r[1],location_address:t,location_name:p.location_name,note:p.note,oid:p.id,related_event:p.related_event,repeat_mode:p.repeat_mode,seconds_to_notify_before:p.seconds_to_notify_before,status:p.lightweight_event_status,title:p.event_title,track_rsvp:w}}function i(p){__p&&__p();var q=p.associated_object;if(q==null)return null;else{var r=q.action_link,s;if(r==null)s=null;else{var t=+c("WorkModeConfig").is_work_user,u=t!==0?c("WorkModeConfig").company_subdomain+".facebook.com":"www.facebook.com";s=new(c("URI"))(r).setDomain(u)}var v=q.profile_picture;return{id:q.id,name:q.name,action_link:s,profile_picture:v==null?null:{uri:v.uri},room_type:q.room_type,privacy_mode:q.privacy_mode,approval_mode_toggleable:q.approval_mode_toggleable,start_timestamp:q.start_timestamp,event_place:q.event_place}}}function j(p){var q=p.related_page_thread;if(q==null)return null;else{var r=c("bs_array").map(function(u){return u.name},q.custom_thread_tags.nodes),s=q.page,t=s==null?null:s.id;return{flagged:q.is_flagged,pageID:t,customTagNames:r}}}function k(p){__p&&__p();var q=p.thread_key.other_user_id;if(q==null)return 0;else{var r=p.all_participants.nodes;return c("bs_array").fold_left(function(s,t){var u=t.messaging_actor;if(u.id===q)return+(u.__typename==="User");else return s},0,r)}}function l(p){__p&&__p();if(p.length){var q={};c("bs_array").iter(function(r){var s=r.nickname;if(s==null)return 0;else{q[r.participant_id]=s;return 0}},p);return q}else return null}function m(p){if(!(p==null)&&p!=="")return"#"+c("bs_string").sub(p,2,p.length-2|0);else return null}function n(p){return c("bs_caml_array").caml_array_get(p,0)}function o(p,q,r){__p&&__p();var s=q.customization_info,t;if(s==null)t=[null,null,null];else{var u=s.emoji;t=[m(s.outgoing_bubble_color),u==null?null:{emoji:u},l(s.participant_customizations)]}var v=q.page_comm_item,w=v==null?[null,null,null,null,null]:[v.comm_status,v.comm_source_id,v.id,v.subtitle,v.comm_item_owners],x=q.last_message.nodes.length?[c("bs_caml_array").caml_array_get(q.last_message.nodes,0)]:0,y=q.last_read_receipt.nodes.length?[c("bs_caml_array").caml_array_get(q.last_read_receipt.nodes,0)]:0,z;if(x){var A=x[0];z=c("messengerAttachmentTransformerRe").transformAttachment(p,{extensible_attachment:A.extensible_attachment,blob_attachments:A.blob_attachments,sticker:A.sticker},r)}else z=[];var B=q.cannot_reply_reason,C=q.thread_queue_metadata,D=q.thread_type,E=q.montage_thread,F=q.image,G=q.thread_key.other_user_id,H=q.thread_queue_metadata,I=q.name,J=q.thread_key.other_user_id,K;if(J==null){var L=q.thread_key.thread_fbid;K=L==null?null:L}else K=J;var M=q.rtc_call_data,N;if(M==null)N=null;else{var O=M.initiator;N={call_state:M.call_state,server_info_data:M.server_info_data,initiator_fbid:O==null?0:c("bs_caml_format").caml_float_of_string(O.id)}}return{admin_ids:c("bs_array").map(function(P){return P.id},q.thread_admins),approval_mode:q.approval_mode,approval_queue_ids:C==null?[]:c("bs_array").map(function(P){return c("MercuryIDs").getParticipantIDFromUserID(P.id)},C.approval_requests.nodes),can_reply:B==null?true:false,cannot_reply_reason:q.cannot_reply_reason,custom_color:t[0],custom_like_icon:t[1],custom_nickname:t[2],customization_enabled:q.customization_enabled,thread_type:D==null?null:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingThreadType")[D])),participant_add_mode:q.participant_add_mode_as_string,ephemeral_ttl_mode:q.ephemeral_ttl_mode,folder:c("bs_string").lowercase(q.folder),has_email_participant:B==null?false:c("bs_js_boolean").to_js_boolean(+(B===c("MessengerThreadCannotReplyReason").HAS_EMAIL_PARTICIPANT)),has_montage:E==null?false:true,image_src:F==null?null:F.uri,is_archived:c("bs_js_boolean").to_js_boolean(q.has_viewer_archived),is_canonical_user:c("bs_js_boolean").to_js_boolean(k(q)),is_canonical:G==null?false:true,is_pin_protected:c("bs_js_boolean").to_js_boolean(q.is_pin_protected),is_subscribed:c("bs_js_boolean").to_js_boolean(q.is_viewer_subscribed),is_canonical_neo_user:c("bs_js_boolean").to_js_boolean(q.is_canonical_neo_user),is_thread_queue_enabled:H==null?false:true,joinable_mode:{mode:c("bs_caml_format").caml_int_of_string(q.joinable_mode.mode),link:q.joinable_mode.link},last_message_timestamp:x?c("bs_caml_format").caml_float_of_string(x[0].timestamp_precise):0,last_message_type:x?x[0].commerce_message_type:null,last_read_timestamp:y?c("bs_caml_format").caml_float_of_string(y[0].timestamp_precise):0,lightweight_event:q.event_reminders.nodes.length?h(c("bs_caml_array").caml_array_get(q.event_reminders.nodes,0)):null,message_count:q.message_count,mute_until:q.mute_until,name:I==null?"":I,other_user_fbid:q.thread_key.other_user_id,page_thread_info:j(q),participants:c("bs_array").map(function(P){return c("MercuryIDs").getParticipantIDFromUserID(P.messaging_actor.id)},q.all_participants.nodes),participants_event_status:q.participants_event_status,read_only:B==null?false:c("bs_js_boolean").to_js_boolean(+(B===c("MessengerThreadCannotReplyReason").READ_ONLY)),recipients_loadable:B==null?true:c("bs_js_boolean").to_js_boolean(+(B!==c("MessengerThreadCannotReplyReason").RECIPIENTS_NOT_LOADABLE)),server_timestamp:c("bs_caml_format").caml_float_of_string(q.updated_time_precise),snippet_attachments:z,snippet_sender:x?c("MercuryIDs").getParticipantIDFromUserID(x[0].message_sender.messaging_actor.id):null,snippet:x?x[0].snippet:null,thread_fbid:K,thread_id:"",timestamp:c("bs_caml_format").caml_float_of_string(q.updated_time_precise),unread_count:q.unread_count,rtc_call_data:N,associated_object:i(q),reactions_mute_mode:q.reactions_mute_mode==="REACTIONS_NOT_MUTED"?0:1,mentions_mute_mode:q.mentions_mute_mode==="MENTIONS_NOT_MUTED"?0:1,comm_status:w[0],page_comm_item_id:w[2],comm_source_id:w[1],subtitle:w[3],comm_item_owners:w[4]}}g._getLightweightEvent=h;g._getAssociatedObject=i;g._getPageThreadInfo=j;g._getIsCanonicalUser=k;g._getNicknames=l;g._getCustomColor=m;g.indexZero=n;g.transformThread=o}),null);
__d("messengerGraphQLThreadFetcherRe",["Promise","bs_array","getByPath","bs_caml_array","bs_pervasives","WebGraphQL","messengerThreadTransformerRe","messengerMessageTransformerRe","MessengerThreadsWebGraphQLQuery","messengerReadReceiptTransformerRe"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(l,m,n){var o=c("bs_array").map(function(p){var q=c("messengerMessageTransformerRe").unsafeCastBlobAttachments(p),r=p.extensible_attachment,s;if(r==null)s=null;else{var t=r.story_attachment;s={legacy_attachment_id:r.legacy_attachment_id,story_attachment:t==null?null:c("messengerMessageTransformerRe").unsafeCastExtensibleAttachment(t)}}return{snippet:p.snippet,message_sender:p.message_sender,timestamp_precise:p.timestamp_precise,commerce_message_type:p.commerce_message_type,extensible_attachment:s,blob_attachments:q,sticker:p.sticker}},m.last_message.nodes);return c("messengerThreadTransformerRe").transformThread(l,{thread_key:m.thread_key,name:m.name,all_participants:m.all_participants,last_message:{nodes:o},unread_count:m.unread_count,message_count:m.messages_count,image:m.image,updated_time_precise:m.updated_time_precise,mute_until:m.mute_until,is_pin_protected:m.is_pin_protected,is_viewer_subscribed:m.is_viewer_subscribed,is_canonical_neo_user:m.is_canonical_neo_user,thread_queue_enabled:m.thread_queue_enabled,folder:m.folder,has_viewer_archived:m.has_viewer_archived,cannot_reply_reason:m.cannot_reply_reason,ephemeral_ttl_mode:m.ephemeral_ttl_mode,customization_info:m.customization_info,thread_admins:m.thread_admins,approval_mode:m.approval_mode,joinable_mode:m.joinable_mode,thread_queue_metadata:m.thread_queue_metadata,event_reminders:m.event_reminders,montage_thread:m.montage_thread,last_read_receipt:m.last_read_receipt,related_page_thread:m.related_page_thread,rtc_call_data:m.rtc_call_data,associated_object:m.associated_object,reactions_mute_mode:m.reactions_mute_mode,mentions_mute_mode:m.mentions_mute_mode,privacy_mode:m.privacy_mode,customization_enabled:m.customization_enabled,thread_type:m.thread_type,participant_add_mode_as_string:m.participant_add_mode_as_string,participants_event_status:m.participants_event_status,page_comm_item:m.page_comm_item},n)}function i(l,m,n,o,p){__p&&__p();if(l==null)if(o!==0)return{actions:null,thread:undefined,end_of_history:{type:"user",fbid:m},roger:null};else return{actions:null,thread:undefined,end_of_history:undefined,roger:null};else{var q=l.thread_key.other_user_id,r=l.thread_key.thread_fbid,s=q==null?r==null?c("bs_pervasives").failwith("No thread ID"):r:q;if(s!==m)c("bs_pervasives").failwith("Thread ID mismatch");var t=h(n,l,p),u=l.messages,v=u==null?null:c("bs_array").map(function(A){return c("messengerMessageTransformerRe").transformMessage(n,A,{thread_id:null,thread_fbid:l.thread_key.thread_fbid,other_user_fbid:l.thread_key.other_user_id,folder:t.folder},p)},u.nodes),w=l.read_receipts,x;if(w==null)x=null;else{var y={};y[m]=c("messengerReadReceiptTransformerRe").transformReadReceipt(n,w);x=y}var z=c("getByPath")(l,["messages","page_info"]);if(z==null)return{actions:v,thread:t,end_of_history:undefined,roger:x};else if(z.has_previous_page)return{actions:v,thread:t,end_of_history:undefined,roger:x};else return{actions:v,thread:t,end_of_history:{type:"thread",fbid:m},roger:x}}}function j(l){return new(c("MessengerThreadsWebGraphQLQuery"))({id:l.id,message_limit:l.limit,load_messages:+(l.limit>0),load_read_receipts:l.loadReadReceipts,before:l.timestamp})}function k(l,m,n){var o=c("bs_array").map(j,m);return c("Promise").all(c("WebGraphQL").execAll(o,{actorID:n?l:null,batchName:"MessengerGraphQLThreadFetcherRe"})).then(function(p){return c("bs_array").mapi(function(q,r){var s=r.message_thread,t=c("bs_caml_array").caml_array_get(m,q);return i(s,t.id,l,t.isCanonical,n)},p)})}g.transformThread=h;g._transformPayload=i;g._getQuery=j;g.fetchAll=k}),null);
__d("chatInitialDataTransformerRe",["bs_array","bs_js_dict","getByPath","bs_caml_array","bs_caml_format","messengerMessageTransformerRe","messengerGraphQLThreadFetcherRe","messengerReadReceiptTransformerRe","messengerGraphQLThreadlistFetcherRe"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){__p&&__p();var j=i.viewer,k=+i.is_page,l=[],m=[],n={},o=[],p={},q=[];c("bs_array").iter(function(r){__p&&__p();if(r==null)return 0;else{var s=c("messengerGraphQLThreadFetcherRe").transformThread(j,r,k);l.push(s);var t=r.messages;if(!(t==null))c("bs_array").iter(function(G){m.push(c("messengerMessageTransformerRe").transformMessage(j,G,{thread_id:null,thread_fbid:r.thread_key.thread_fbid,other_user_fbid:r.thread_key.other_user_id,folder:s.folder},k));return 0},t.nodes);var u=c("getByPath")(r,["messages","page_info"]);if(!(u==null))if(!u.has_previous_page){var v=r.thread_key.thread_fbid,w=r.thread_key.other_user_id;if(v==null){if(!(w==null))q.push({type:"thread",fbid:w})}else q.push({type:"thread",fbid:v})}var x=r.read_receipts;if(!(x==null)){var y=c("messengerReadReceiptTransformerRe").transformReadReceipt(j,x),z=r.thread_key.thread_fbid;if(!(z==null))n[z]=y;var A=r.thread_key.other_user_id;if(!(A==null))n[A]=y}var B=r.delivery_receipts;if(!(B==null)){var C=B.nodes.sort(function(G,H){var I=c("bs_caml_format").caml_float_of_string(G.timestamp_precise),J=c("bs_caml_format").caml_float_of_string(H.timestamp_precise);if(I>J)return-1;else if(I===J)return 0;else return 1});if(C.length>=1){var D=c("bs_caml_array").caml_array_get(C,0);if(s.is_canonical){var E=s.other_user_fbid;if(!(E==null))o.push({other_user_fbid:E,thread_fbid:null,time:c("bs_caml_format").caml_float_of_string(D.timestamp_precise)})}else{var F=s.thread_fbid;if(!(F==null))o.push({other_user_fbid:null,thread_fbid:F,time:c("bs_caml_format").caml_float_of_string(D.timestamp_precise)})}}}return c("bs_array").iter(function(G){var H=c("messengerGraphQLThreadlistFetcherRe").transformParticipant(G.messaging_actor);p[H.fbid]=H;return 0},r.all_participants.nodes)}},i.threads);return{threads:l,actions:m,roger:n,delivery_receipts:o,participants:c("bs_js_dict").values(p),end_of_history:q}}g.transform=h}),null);